var jinqJs=function(n){"use strict";var t=[],r=[],e=[],u=!1;jinqJs.settings="undefined"!=typeof n?n:{includeIdentity:!1};var i=function(n){return"undefined"==typeof n||0===n.length},s=function(n){return a(n,"length")&&!l(n)&&!f(n)},l=function(n){return null!==n&&n.constructor===String},a=function(n,t){return"undefined"!=typeof n[t]},f=function(n){return"function"==typeof n},o=function(n,t,r){for(var e=0;e<n.length;e++)if(n[e][t]==r)return!0;return!1},g=function(n,t){return c(n,t,!0)},c=function(n,t,r){var e=null,u=!1,i=[];r=r||!1;for(var s=0;s<n.length;s++){u=!1;for(var l in t){if(e=n[s],e[l]!=t[l]){u=!1;break}u=!0}if(u){if(r)return e;i.push(e)}}return 0===i.length?null:i},h=function(n,t){for(var r={},e=null,u=0;u<t.length;u++)e=t[u],r[e]=a(n,e)?n[e]:0;return r},v=function(n,t){for(var u=[],i=null,s=null,l=null,a=0;a<r.length;a++)if(i=h(r[a],e),s=h(r[a],n),l=g(u,i),null===l){l={};for(var f in i)l[f]=i[f];for(var o in s)l[o]=t(l[o],s[o],JSON.stringify(i)+o);u.push(l)}else for(var c in s)l[c]=t(l[c],r[a][c],JSON.stringify(i)+c);return u},m=function(n){for(var t=null,e=null,u=null,i=null,s=null,l=null,f=null,o=1,g=null,c=null,h=!1,v=0;v<n.length;v++)e=v>0?n[v-1]:null,t=n[v],u=a(t,"field")?t.field:null,o=a(t,"sort")&&"desc"===t.sort?-1:1,h=null===u||isNaN(u)?!1:!0,r.sort(function(n,t){return h?(i=Object.keys(n)[u],s=Object.keys(t)[u],null!==e&&(l=Object.keys(n)[e.field],f=Object.keys(t)[e.field])):(i=s=u,null!==e&&(l=f=e.field)),g=null===u?n:isNaN(n[i])?n[i]:Number(n[i]),c=null===u?t:isNaN(t[s])?t[s]:Number(t[s]),c>g&&(null===e||null===u||n[l]==t[f])?-1*o:g>c&&(null===e||null===u||n[l]==t[f])?1*o:0})},d=function(n){for(var t=[],r=0;r<n.length;r++)t=t.concat(n[r]);return t},p=function(n){for(var t={},r=0;r<n.length;r++)for(var e in n[r])t[e]=n[r][e];return t},y=function(n){var t={};for(var r in n)t[r]="";return t},b=function(n,e){var u=null,i=[],l=null,a=[],o=1;if(s(e)&&0!==e.length&&0!==t.length){switch(n){case"from":if(1===t.length)return void(r=t[0]);a=t[0];break;case"inner":case"left":a=r,o=0;break;default:return}for(var g=o;g<t.length;g++)i=[],a.forEach(function(r){f(e[0])?(l=[],t[g].forEach(function(n){e[0](r,n)&&l.push(n)}),0===l.length&&(l=null)):(u=h(r,e),l=c(t[g],u)),null!==l?l.forEach(function(n){i.push(p([n,r]))}):"left"===n&&(t[g].length>0&&(u=y(t[g][0]),u=p([u,r])),i.push(p([r,u])))}),a=i;t=[],r=i}},N=function(n,r){if(0===r.length)return this;t=[],t.func=n;for(var e=0;e<r.length;e++)r[e].length>0&&t.push(r[e])},k=function(){var n=null,e=null;if(0===arguments.length)return this;for(var u=0;u<arguments.length;u++)if(null!==arguments[u]&&0!==arguments[u].length){if(2==arguments.length&&f(arguments[1]))n=arguments[0],e=arguments[1],u=arguments.length;else if(n=arguments[u],f(n))continue;if(l(n)){var i=new XMLHttpRequest;if(f(e)&&(i.self=this,i.onreadystatechange=function(){if(0!==i.response.length){var u=JSON.parse(i.response);n=s(u)?u:new Array(u),t.push(n),r=n,e(this.self)}}),i.open("GET",n,f(e)),i.send(),!f(e)){var a=JSON.parse(i.response);n=s(a)?a:new Array(a),t.push(n)}}else t.push(n)}return t.func="from",r=d(t),f(e)?e:this},O=function(){var n=null,t=!1,e=!1,l=[];if(i(r))return[];var o=null,g=null,c=null;if(jinqJs.settings.includeIdentity&&!u&&D(),i(arguments))return r;s(arguments[0])?(n=arguments[0],t=!0):f(arguments[0])?(n=arguments[0],e=!0):n=arguments;for(var h=0;h<r.length;h++){if(o={},e)o=n(r[h]);else for(var v=0;v<n.length;v++)t?(a(n[v],"field")&&(g=isNaN(n[v].field)?n[v].field:Object.keys(r[h])[n[v].field]),c=a(n[v],"text")?n[v].text:n[v].field):c=g=n[v],o[c]=a(n[v],"value")?f(n[v].value)?n[v].value(r[h]):n[v].value:a(r[h],g)?r[h][g]:r[h];l.push(o)}return l},J=function(){t.func=null;for(var n=0;n<arguments.length;n++)r=r.concat(arguments[n]);return this},S=function(n){var t=0;return t=Math.abs(n)>0&&Math.abs(n)<1?r.length*n:n,r=0>n?r.slice(t,r.length- -1*Math.abs(t)):r.slice(0,t),this},j=function(n){return S(-1*n),this},w=function(n){var t=[],e=!1,u=/([^\s]+)\s([<>=!*]{1,2})\s(.+)/,i=!1;if("undefined"==typeof n)return this;e=f(n);for(var s=0;s<r.length;s++){var l=r[s];if(e)n(l)&&t.push(l);else{for(var a=0;a<arguments.length;a++){var o=arguments[a].match(u);if(i=!1,null===o||4!==o.length)throw"Invalid predicate!";var g=o[2],c=o[1],h=o[3];switch(g){case"<":l[c]<h&&(i=!0);break;case">":l[c]>h&&(i=!0);break;case"!=":l[c]!=h&&(i=!0);break;case"=":case"==":l[c]==h&&(i=!0);break;case"<=":l[c]<=h&&(i=!0);break;case">=":l[c]>=h&&(i=!0);break;case"*":l[c].indexOf(h)>-1&&(i=!0)}if(!i)break}i&&t.push(l)}}return r=t,this},q=function(){if(i(arguments))return this;for(var n=[],t=null,e=null,u=0;u<r.length;u++){t=h(r[u],arguments);for(var s=0;s<arguments.length;s++)if(e=arguments[s],!o(n,e,t[e])){n.push(t);break}}return r=n,this},x=function(){return e=arguments,this},E=function(){var n={};return r=v(arguments,function(t,r,e){var u=e;return a(n,u)||(n[u]=0),n[u]+=r}),this},I=function(){var n={};return r=v(arguments,function(t,r,e){var u=JSON.stringify(e);return a(n,u)||(n[u]={count:0,sum:0}),n[u].count++,n[u].sum+=r,n[u].sum/n[u].count}),this},M=function(){var n={};return r=v(arguments,function(t,r,e){var u=JSON.stringify(e);return a(n,u)||(n[u]=0),++n[u]}),this},A=function(){var n={};return r=v(arguments,function(t,r,e){var u=JSON.stringify(e);return a(n,u)||(n[u]=0),(0===n[u]||r<n[u])&&(n[u]=r),n[u]}),this},B=function(){var n={};return r=v(arguments,function(t,r,e){var u=JSON.stringify(e);return a(n,u)||(n[u]=0),r>n[u]&&(n[u]=r),n[u]}),this},D=function(){var n=1,t=0===arguments.length?"ID":arguments[0];u=!0;for(var e=0;e<r.length;e++)r[e][t]=n++;return this},G=function(){var n=arguments;return arguments.length>0&&s(arguments[0])?(m(arguments[0]),this):(r.sort(function(t,r){var e=JSON.stringify(h(t,n)),u=JSON.stringify(h(r,n));return u>e?-1:e>u?1:0}),this)},H=function(){if(0===arguments.length||!s(arguments[0])||0===arguments[0].length)return this;var n=d(arguments);J(n),e=[];for(var t in arguments[0][0])e.push(t);return M(),this},L=function(){return 0!==arguments.length&&a(t,"func")?(b(t.func,arguments),t.func=null,this):this},R=function(){return N("inner",arguments),this},T=function(){return N("left",arguments),this};return{from:k,select:O,top:S,bottom:j,where:w,distinct:q,groupBy:x,sum:E,count:M,min:A,max:B,avg:I,identity:D,orderBy:G,on:L,join:R,leftJoin:T,concat:J,union:H}};