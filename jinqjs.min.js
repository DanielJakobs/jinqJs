var jinqJs=function(n){"use strict";var t=[],r=[],e=[],u=!1,i=!1;jinqJs.settings="undefined"!=typeof n?n:{includeIdentity:!1};var l=function(n){return"undefined"==typeof n||0===n.length},s=function(n){return o(n,"length")&&!f(n)&&!c(n)},a=function(n){return null!==n&&n.constructor===Object},f=function(n){return null!==n&&n.constructor===String},o=function(n,t){return"undefined"!=typeof n[t]},c=function(n){return"function"==typeof n},g=function(n,t,r){for(var e=0;e<n.length;e++)if(n[e][t]==r)return!0;return!1},h=function(n,t){return v(n,t,!0)},v=function(n,t,r){var e=null,u=!1,i=[],l=!1;r=r||!1;for(var s=0;s<n.length;s++){u=!1;for(var f in t){if(e=n[s],l=a(e),!l&&e!=t[f]||l&&e[f]!=t[f]){u=!1;break}u=!0}if(u){if(r)return e;i.push(e)}}return 0===i.length?null:i},m=function(n,t){for(var r={},e=null,u=0;u<t.length;u++)e=t[u],r[e]=o(n,e)?n[e]:0;return r},d=function(n,t){for(var u=[],i=null,l=null,s=null,a=0;a<r.length;a++)if(i=m(r[a],e),l=m(r[a],n),s=h(u,i),null===s){s={};for(var f in i)s[f]=i[f];for(var o in l)s[o]=t(s[o],l[o],JSON.stringify(i)+o);u.push(s)}else for(var c in l)s[c]=t(s[c],r[a][c],JSON.stringify(i)+c);return u},p=function(n){for(var t=null,e=null,u=null,i=null,l=null,s=null,a=null,f=1,c=null,g=null,h=!1,v=0;v<n.length;v++)e=v>0?n[v-1]:null,t=n[v],u=o(t,"field")?t.field:null,f=o(t,"sort")&&"desc"===t.sort?-1:1,h=null===u||isNaN(u)?!1:!0,r.sort(function(n,t){return h?(i=Object.keys(n)[u],l=Object.keys(t)[u],null!==e&&(s=Object.keys(n)[e.field],a=Object.keys(t)[e.field])):(i=l=u,null!==e&&(s=a=e.field)),c=null===u?n:isNaN(n[i])?n[i]:Number(n[i]),g=null===u?t:isNaN(t[l])?t[l]:Number(t[l]),g>c&&(null===e||null===u||n[s]==t[a])?-1*f:c>g&&(null===e||null===u||n[s]==t[a])?1*f:0})},y=function(n){for(var t=[],r=0;r<n.length;r++)t=t.concat(n[r]);return t},b=function(n){for(var t={},r=0;r<n.length;r++)for(var e in n[r])t[e]=n[r][e];return t},N=function(n){var t={};for(var r in n)t[r]="";return t},k=function(n,e){var u=null,i=[],l=null,a=[],o=1;if(s(e)&&0!==e.length&&0!==t.length){switch(n){case"from":if(1===t.length)return void(r=t[0]);a=t[0];break;case"inner":case"left":a=r,o=0;break;default:return}for(var g=o;g<t.length;g++)i=[],a.forEach(function(r){c(e[0])?(l=[],t[g].forEach(function(n){e[0](r,n)&&l.push(n)}),0===l.length&&(l=null)):(u=m(r,e),l=v(t[g],u)),null!==l?f(l[0])?i.push(r):l.forEach(function(n){i.push(b([n,r]))}):"left"===n&&(t[g].length>0&&(u=N(t[g][0]),u=b([u,r])),i.push(b([r,u])))}),a=i;t=[],r=i}},O=function(n,r){if(0===r.length)return this;t=[],t.func=n;for(var e=0;e<r.length;e++)r[e].length>0&&t.push(r[e])},J=function(){var n=null,e=null;if(0===arguments.length)return this;for(var u=0;u<arguments.length;u++)if(null!==arguments[u]&&0!==arguments[u].length){if(2==arguments.length&&c(arguments[1]))n=arguments[0],e=arguments[1],u=arguments.length;else if(n=arguments[u],c(n))continue;if(f(n)){var i=new XMLHttpRequest;if(c(e)&&(i.self=this,i.onreadystatechange=function(){if(0!==i.response.length){var u=JSON.parse(i.response);n=s(u)?u:new Array(u),t.push(n),r=n,e(this.self)}}),i.open("GET",n,c(e)),i.send(),!c(e)){var l=JSON.parse(i.response);n=s(l)?l:new Array(l),t.push(n)}}else t.push(n)}return t.func="from",r=y(t),c(e)?e:this},S=function(){var n=null,t=!1,e=!1,u=[];if(l(r))return[];var a=null,f=null,g=null;if(jinqJs.settings.includeIdentity&&!i&&H(),l(arguments))return r;s(arguments[0])?(n=arguments[0],t=!0):c(arguments[0])?(n=arguments[0],e=!0):n=arguments;for(var h=0;h<r.length;h++){if(a={},e)a=n(r[h],h);else for(var v=0;v<n.length;v++)t?(o(n[v],"field")&&(f=isNaN(n[v].field)?n[v].field:Object.keys(r[h])[n[v].field]),g=o(n[v],"text")?n[v].text:n[v].field):g=f=n[v],a[g]=o(n[v],"value")?c(n[v].value)?n[v].value(r[h]):n[v].value:o(r[h],f)?r[h][f]:r[h];u.push(a)}return u},j=function(){t.func=null;for(var n=0;n<arguments.length;n++)r=r.concat(arguments[n]);return this},w=function(n){var t=0;return t=Math.abs(n)>0&&Math.abs(n)<1?r.length*n:n,r=0>n?r.slice(t,r.length- -1*Math.abs(t)):r.slice(0,t),this},I=function(n){return w(-1*n),this},q=function(n){var t=[],e=!1,u=/([^\s]+)\s([<>=!*]{1,2})\s(.+)/,i=!1;if("undefined"==typeof n)return this;e=c(n);for(var l=0;l<r.length;l++){var s=r[l];if(e)n(s,l)&&t.push(s);else{for(var a=0;a<arguments.length;a++){var f=arguments[a].match(u);if(i=!1,null===f||4!==f.length)throw"Invalid predicate!";var o=f[2],g=f[1],h=f[3];switch(o){case"<":s[g]<h&&(i=!0);break;case">":s[g]>h&&(i=!0);break;case"!=":s[g]!=h&&(i=!0);break;case"=":case"==":s[g]==h&&(i=!0);break;case"<=":s[g]<=h&&(i=!0);break;case">=":s[g]>=h&&(i=!0);break;case"*":s[g].indexOf(h)>-1&&(i=!0)}if(!i)break}i&&t.push(s)}}return r=t,this},x=function(){if(l(arguments))return this;for(var n=[],t=null,e=null,u=0;u<r.length;u++){t=m(r[u],arguments);for(var i=0;i<arguments.length;i++)if(e=arguments[i],!g(n,e,t[e])){n.push(t);break}}return r=n,this},E=function(){return e=arguments,this},M=function(){var n={};return r=d(arguments,function(t,r,e){var u=e;return o(n,u)||(n[u]=0),n[u]+=r}),this},A=function(){var n={};return r=d(arguments,function(t,r,e){var u=JSON.stringify(e);return o(n,u)||(n[u]={count:0,sum:0}),n[u].count++,n[u].sum+=r,n[u].sum/n[u].count}),this},B=function(){var n={};return r=d(arguments,function(t,r,e){var u=JSON.stringify(e);return o(n,u)||(n[u]=0),++n[u]}),this},D=function(){var n={};return r=d(arguments,function(t,r,e){var u=JSON.stringify(e);return o(n,u)||(n[u]=0),(0===n[u]||r<n[u])&&(n[u]=r),n[u]}),this},G=function(){var n={};return r=d(arguments,function(t,r,e){var u=JSON.stringify(e);return o(n,u)||(n[u]=0),r>n[u]&&(n[u]=r),n[u]}),this},H=function(){var n=1,t=0===arguments.length?"ID":arguments[0];i=!0;for(var e=0;e<r.length;e++)r[e][t]=n++;return this},L=function(){var n=arguments;return arguments.length>0&&s(arguments[0])?(p(arguments[0]),this):(r.sort(function(t,r){var e=JSON.stringify(m(t,n)),u=JSON.stringify(m(r,n));return u>e?-1:e>u?1:0}),this)},R=function(){if(0===arguments.length||!s(arguments[0])||0===arguments[0].length)return this;var n=y(arguments);j(n),e=[];for(var t in arguments[0][0])e.push(t);return B(),this},T=function(){return 0!==arguments.length&&o(t,"func")?(k(t.func,arguments),t.func=null,this):this},X=function(n,t){var e=[],i=null,l=null,s=!1;if(0===n.length||0===r.length)return this;var f=!a(n[0]),o=!a(r[0]);if(!(f&&o||"undefined"!=typeof t))throw"Invalid field or missing field!";for(var c=0;c<r.length;c++){i=o?r[c]:r[c][t],s=!1;for(var g=0;g<n.length;g++)if(l=f?n[g]:n[g][t],i===l){s=!0;break}(s&&!u||!s&&u)&&e.push(r[c])}return u=!1,r=e,this},z=function(){return O("inner",arguments),this},C=function(){return O("left",arguments),this},F=function(){return u=!0,this};return{from:J,select:S,top:w,bottom:I,where:q,distinct:x,groupBy:E,sum:M,count:B,min:D,max:G,avg:A,identity:H,orderBy:L,on:T,join:z,leftJoin:C,concat:j,union:R,not:F,"in":X}};