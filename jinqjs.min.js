var jinqJs=function(n){"use strict";var r=[],t=[],e=[],u=!1;jinqJs.settings="undefined"!=typeof n?n:{includeIdentity:!1};var i=function(n){return"undefined"==typeof n||0===n.length},s=function(n){return l(n,"length")&&!a(n)&&!f(n)},a=function(n){return null!==n&&n.constructor===String},l=function(n,r){return"undefined"!=typeof n[r]},f=function(n){return"function"==typeof n},o=function(n,r,t){for(var e=0;e<n.length;e++)if(n[e][r]==t)return!0;return!1},g=function(n,r){return c(n,r,!0)},c=function(n,r,t){var e=null,u=!1,i=[];t=t||!1;for(var s=0;s<n.length;s++){u=!1;for(var a in r){if(e=n[s],e[a]!=r[a]){u=!1;break}u=!0}if(u){if(t)return e;i.push(e)}}return 0===i.length?null:i},h=function(n,r){for(var t={},e=null,u=0;u<r.length;u++)e=r[u],t[e]=l(n,e)?n[e]:0;return t},v=function(n,r){for(var u=[],i=null,s=null,a=null,l=0;l<t.length;l++)if(i=h(t[l],e),s=h(t[l],n),a=g(u,i),null===a){a={};for(var f in i)a[f]=i[f];for(var o in s)a[o]=r(a[o],s[o],JSON.stringify(i)+o);u.push(a)}else for(var c in s)a[c]=r(a[c],t[l][c],JSON.stringify(i)+c);return u},m=function(n){for(var r=null,e=null,u=null,i=1,s=null,a=null,f=0;f<n.length;f++)e=f>0?n[f-1]:null,r=n[f],u=l(r,"field")?r.field:null,i=l(r,"sort")&&"desc"===r.sort?-1:1,t.sort(function(n,r){return s=null===u?n:isNaN(n[u])?n[u]:Number(n[u]),a=null===u?r:isNaN(r[u])?r[u]:Number(r[u]),a>s&&(null===e||null===u||n[e.field]==r[e.field])?-1*i:s>a&&(null===e||null===u||n[e.field]==r[e.field])?1*i:0})},d=function(n){for(var r=[],t=0;t<n.length;t++)r=r.concat(n[t]);return r},p=function(n){for(var r={},t=0;t<n.length;t++)for(var e in n[t])r[e]=n[t][e];return r},y=function(n){var r={};for(var t in n)r[t]="";return r},b=function(n,e){var u=null,i=[],a=null,l=[],o=1;if(s(e)&&0!==e.length&&0!==r.length){switch(n){case"from":if(1===r.length)return void(t=r[0]);l=r[0];break;case"inner":case"left":l=t,o=0;break;default:return}for(var g=o;g<r.length;g++)i=[],l.forEach(function(t){f(e[0])?(a=[],r[g].forEach(function(n){e[0](t,n)&&a.push(n)}),0===a.length&&(a=null)):(u=h(t,e),a=c(r[g],u)),null!==a?a.forEach(function(n){i.push(p([n,t]))}):"left"===n&&(r[g].length>0&&(u=y(r[g][0]),u=p([u,t])),i.push(p([t,u])))}),l=i;r=[],t=i}},N=function(n,t){if(0===t.length)return this;r=[],r.func=n;for(var e=0;e<t.length;e++)t[e].length>0&&r.push(t[e])},J=function(){var n=null,e=null;if(0===arguments.length)return this;for(var u=0;u<arguments.length;u++)if(null!==arguments[u]&&0!==arguments[u].length){if(2==arguments.length&&f(arguments[1]))n=arguments[0],e=arguments[1],u=arguments.length;else if(n=arguments[u],f(n))continue;if(a(n)){var i=new XMLHttpRequest;if(f(e)&&(i.self=this,i.onreadystatechange=function(){if(0!==i.response.length){var u=JSON.parse(i.response);n=s(u)?u:new Array(u),r.push(n),t=n,e(this.self)}}),i.open("GET",n,f(e)),i.send(),!f(e)){var l=JSON.parse(i.response);n=s(l)?l:new Array(l),r.push(n)}}else r.push(n)}return r.func="from",t=d(r),f(e)?e:this},k=function(){var n=null,r=!1,e=!1,a=[];if(i(t))return[];var o=null,g=null,c=null;if(jinqJs.settings.includeIdentity&&!u&&D(),i(arguments))return t;s(arguments[0])?(n=arguments[0],r=!0):f(arguments[0])?(n=arguments[0],e=!0):n=arguments;for(var h=0;h<t.length;h++){if(o={},e)o=n(t[h]);else for(var v=0;v<n.length;v++)r?(l(n[v],"field")&&(g=n[v].field),c=l(n[v],"text")?n[v].text:n[v].field):c=g=n[v],o[c]=l(n[v],"value")?f(n[v].value)?n[v].value(t[h]):n[v].value:l(t[h],g)?t[h][g]:t[h];a.push(o)}return a},O=function(){r.func=null;for(var n=0;n<arguments.length;n++)t=t.concat(arguments[n]);return this},S=function(n){var r=0;return r=Math.abs(n)>0&&Math.abs(n)<1?t.length*n:n,t=0>n?t.slice(r,t.length- -1*Math.abs(r)):t.slice(0,r),this},w=function(n){return S(-1*n),this},j=function(n){var r=[],e=!1,u=/([^\s]+)\s([<>=!*]{1,2})\s(.+)/,i=!1;if("undefined"==typeof n)return this;e=f(n);for(var s=0;s<t.length;s++){var a=t[s];if(e)n(a)&&r.push(a);else{for(var l=0;l<arguments.length;l++){var o=arguments[l].match(u);if(i=!1,null===o||4!==o.length)throw"Invalid predicate!";var g=o[2],c=o[1],h=o[3];switch(g){case"<":a[c]<h&&(i=!0);break;case">":a[c]>h&&(i=!0);break;case"!=":a[c]!=h&&(i=!0);break;case"=":case"==":a[c]==h&&(i=!0);break;case"<=":a[c]<=h&&(i=!0);break;case">=":a[c]>=h&&(i=!0);break;case"*":a[c].indexOf(h)>-1&&(i=!0)}if(!i)break}i&&r.push(a)}}return t=r,this},q=function(){if(i(arguments))return this;for(var n=[],r=null,e=null,u=0;u<t.length;u++){r=h(t[u],arguments);for(var s=0;s<arguments.length;s++)if(e=arguments[s],!o(n,e,r[e])){n.push(r);break}}return t=n,this},x=function(){return e=arguments,this},E=function(){var n={};return t=v(arguments,function(r,t,e){var u=e;return l(n,u)||(n[u]=0),n[u]+=t}),this},I=function(){var n={};return t=v(arguments,function(r,t,e){var u=JSON.stringify(e);return l(n,u)||(n[u]={count:0,sum:0}),n[u].count++,n[u].sum+=t,n[u].sum/n[u].count}),this},M=function(){var n={};return t=v(arguments,function(r,t,e){var u=JSON.stringify(e);return l(n,u)||(n[u]=0),++n[u]}),this},A=function(){var n={};return t=v(arguments,function(r,t,e){var u=JSON.stringify(e);return l(n,u)||(n[u]=0),(0===n[u]||t<n[u])&&(n[u]=t),n[u]}),this},B=function(){var n={};return t=v(arguments,function(r,t,e){var u=JSON.stringify(e);return l(n,u)||(n[u]=0),t>n[u]&&(n[u]=t),n[u]}),this},D=function(){var n=1,r=0===arguments.length?"ID":arguments[0];u=!0;for(var e=0;e<t.length;e++)t[e][r]=n++;return this},G=function(){var n=arguments;return arguments.length>0&&s(arguments[0])?(m(arguments[0]),this):(t.sort(function(r,t){var e=JSON.stringify(h(r,n)),u=JSON.stringify(h(t,n));return u>e?-1:e>u?1:0}),this)},H=function(){if(0===arguments.length||!s(arguments[0])||0===arguments[0].length)return this;var n=d(arguments);O(n),e=[];for(var r in arguments[0][0])e.push(r);return M(),this},L=function(){return 0!==arguments.length&&l(r,"func")?(b(r.func,arguments),r.func=null,this):this},R=function(){return N("inner",arguments),this},T=function(){return N("left",arguments),this};return{from:J,select:k,top:S,bottom:w,where:j,distinct:q,groupBy:x,sum:E,count:M,min:A,max:B,avg:I,identity:D,orderBy:G,on:L,join:R,leftJoin:T,concat:O,union:H}};