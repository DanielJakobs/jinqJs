var jinqJs=function(n){"use strict";var e=[],r=[],t=[],u=!1,l=!1,a={LessThen:0,LessThenEqual:1,GreaterThen:2,GreaterThenEqual:3,Equal:4,EqualEqualType:5,NotEqual:6,NotEqualEqualType:7,Contains:8};jinqJs.settings=jinqJs.settings||{},jinqJs.settings="undefined"!=typeof n?n:{includeIdentity:jinqJs.settings.includeIdentity||!1};var s=function(n){return"undefined"==typeof n||0===n.length},i=function(n){return g(n,"length")&&!o(n)&&!h(n)},f=function(n){return null!==n&&n.constructor===Object},o=function(n){return null!==n&&n.constructor===String},g=function(n,e){return void 0!==n[e]},h=function(n){return"function"==typeof n},c=function(n){return"number"==typeof n},m=function(n,e,r){for(var t=0;t<n.length;t++)if(n[t][e]===r)return!0;return!1},v=function(n,e){return d(n,e,!0)},d=function(n,e,r){var t=null,u=!1,l=[],a=!1;r=r||!1;for(var s=0;s<n.length;s++){u=!1;for(var i in e){if(t=n[s],a=f(t),!a&&t!=e[i]||a&&t[i]!=e[i]){u=!1;break}u=!0}if(u){if(r)return t;l.push(t)}}return 0===l.length?null:l},p=function(n,e){for(var r={},t=null,u=0;u<e.length;u++)t=e[u],r[t]=g(n,t)?n[t]:0;return r},y=function(n,e){for(var u=[],l=null,a=null,s=null,i=0;i<r.length;i++)if(l=p(r[i],t),a=p(r[i],n),s=v(u,l),null===s){s={};for(var f in l)s[f]=l[f];for(var o in a)s[o]=e(s[o],a[o],JSON.stringify(l)+o);u.push(s)}else for(var g in a)s[g]=e(s[g],r[i][g],JSON.stringify(l)+g);return t=[],u},q=function(n){for(var e=null,t=null,u=null,l=null,a=null,s=null,i=null,f=1,o=null,h=null,c=!1,m=0;m<n.length;m++)t=m>0?n[m-1]:null,e=n[m],u=g(e,"field")?e.field:null,f=g(e,"sort")&&"desc"===e.sort?-1:1,c=null===u||isNaN(u)?!1:!0,r.sort(function(n,e){return c?(l=Object.keys(n)[u],a=Object.keys(e)[u],null!==t&&(s=Object.keys(n)[t.field],i=Object.keys(e)[t.field])):(l=a=u,null!==t&&(s=i=t.field)),o=null===u?n:isNaN(n[l])?n[l]:Number(n[l]),h=null===u?e:isNaN(e[a])?e[a]:Number(e[a]),h>o&&(null===t||null===u||n[s]==e[i])?-1*f:o>h&&(null===t||null===u||n[s]==e[i])?1*f:0})},b=function(n){switch(n.length){case 1:return n[0].concat();case 2:return[].concat(n[0],n[1]);case 3:return[].concat(n[0],n[1],n[2]);case 4:return[].concat(n[0],n[1],n[2],n[3]);case 5:return[].concat(n[0],n[1],n[2],n[3],n[4]);default:for(var e=[],r=0;r<n.length;r++)e=e.concat(n[r]);return e}},E=function(n){for(var e={},r=0;r<n.length;r++)for(var t in n[r])e[t]=n[r][t];return e},N=function(n){var e={};for(var r in n)e[r]="";return e},k=function(n){switch(n){case"<":return a.LessThen;case">":return a.GreaterThen;case"!=":return a.NotEqual;case"!==":return a.NotEqualEqualType;case"=":case"==":return a.Equal;case"===":return a.EqualEqualType;case"<=":return a.LessThenEqual;case">=":return a.GreaterThenEqual;case"*":return a.Contains;default:throw"Invalid Expression!"}},T=function(n){var e=[];for(var r in n)e.push({field:r});return e},J=function(n,t){var u=null,l=[],a=null,s=[],f=1;if(i(t)&&0!==t.length&&0!==e.length){switch(n){case"from":if(1===e.length)return void(r=e[0]);s=e[0];break;case"full":case"inner":case"left":s=r,f=0;break;default:return}for(var g=f;g<e.length;g++){if(l=[],s.forEach(function(r){h(t[0])?(a=[],e[g].forEach(function(n){t[0](r,n)&&a.push(n)}),0===a.length&&(a=null)):(u=p(r,t),a=d(e[g],u)),null!==a?o(a[0])?l.push(r):a.forEach(function(n){l.push(E([n,r]))}):("left"===n||"full"===n)&&(e[g].length>0&&(u=N(e[g][0]),u=E([u,r])),l.push(E([r,u])))}),"full"===n){var c=jinqJs().from(e[g]).not()["in"](l,t).select(T(l[0]));l=l.concat(c)}s=l}e=[],r=l}},O=function(n,r){if(0===r.length)return this;e=[],e.func=n;for(var t=0;t<r.length;t++)r[t].length>0&&e.push(r[t])},j=function(){var n=null,t=null;if(0===arguments.length)return this;r=[];for(var u=0;u<arguments.length;u++)if(null!==arguments[u]&&0!==arguments[u].length){if(2==arguments.length&&h(arguments[1]))n=arguments[0],t=arguments[1],u=arguments.length;else if(n=arguments[u],h(n))continue;if(o(n)){var l=new XMLHttpRequest;if(h(t)&&(l.self=this,l.onreadystatechange=function(){if(0!==l.response.length){var u=JSON.parse(l.response);n=i(u)?u:new Array(u),e.push(n),r=n,t(this.self)}}),l.open("GET",n,h(t)),l.send(),!h(t)){var a=JSON.parse(l.response);n=i(a)?a:new Array(a),e.push(n)}}else e.push(n)}return e.func="from",r=b(e),h(t)?t:this},w=function(){var n=null,e=!1,t=!1,u=null;if(s(r))return[];var a=null,o=null,m=null,v=!1,d=null;if(jinqJs.settings.includeIdentity&&!l&&D(),s(arguments))return r;if(u=new Array(r.length),i(arguments[0])){n=arguments[0],e=!0,d=new Array(n.length);for(var p=0;p<n.length;p++)d[p]={hasField:g(n[p],"field"),hasText:g(n[p],"text"),hasValue:g(n[p],"value")}}else h(arguments[0])?(n=arguments[0],t=!0):n=arguments;v=!f(r[0]);for(var y=0;y<r.length;y++)if(t)u[y]=n(r[y],y);else{a={};for(var q=0;q<n.length;q++)e?(d[q].hasField&&(o=c(n[q].field)?Object.keys(r[y])[n[q].field]:n[q].field),m=d[q].hasText?n[q].text:n[q].field):m=o=n[q],a[m]=e&&d[q].hasValue?h(n[q].value)?n[q].value(r[y]):n[q].value:v?r[y]:r[y][o]||null;u[y]=a}return u},V=function(){e.func=null;for(var n=0;n<arguments.length;n++)r=r.concat(arguments[n]);return this},F=function(n){var e=0;return e=n>-1&&1>n?r.length*n:n,r=0>n?r.slice(e,r.length- -1*Math.abs(e)):r.slice(0,e),this},S=function(n){return F(-1*n),this},x=function(n){var e=[],t=!1,u=!1,l=arguments.length,s=r.length,i=new Array(l),f=null;if("undefined"==typeof n)return this;if(t=h(n),!t)for(var o=0;l>o;o++){var g=arguments[o].split(" ");if(3!==g.length)throw"Invalid expression!";i[o]={lField:g[0],operator:k(g[1]),rValue:g[2]}}for(var c=0;s>c;c++)if(f=r[c],t)n(f,c)&&e.push(f);else{for(var m=0;l>m;m++){switch(i[m].operator){case a.EqualEqualType:u=f[i[m].lField]===i[m].rValue;break;case a.NotEqualEqualType:u=f[i[m].lField]!==i[m].rValue;break;case a.LessThen:u=f[i[m].lField]<i[m].rValue;break;case a.GreaterThen:u=f[i[m].lField]>i[m].rValue;break;case a.NotEqual:u=f[i[m].lField]!=i[m].rValue;break;case a.Equal:u=f[i[m].lField]==i[m].rValue;break;case a.LessThenEqual:u=f[i[m].lField]<=i[m].rValue;break;case a.GreaterThenEqual:u=f[i[m].lField]>=i[m].rValue;break;case a.Contains:u=f[i[m].lField].indexOf(i[m].rValue)>-1;break;default:u=!1}if(!u)break}u&&e.push(f)}return r=e,this},G=function(){var n=[],e=null,t=null,u=0,l=r.length,a=0,s=!1;if(0===arguments.length)if(f(r[0]))for(u=0;l>u;u++){s=!1;for(var i=0;a>i;i++)if(r[u]===n[i]){s=!0;break}s||(n[a++]=r[u])}else{var o={};for(u=0;u!==l;u++)e=r[u],1!==o[e]&&(o[e]=1,n[n.length]=e)}else for(u=0;l>u;u++){e=p(r[u],arguments);for(var g=0;g<arguments.length;g++)if(t=arguments[g],!m(n,t,e[t])){n.push(e);break}}return r=n,this},I=function(){return t=arguments,this},L=function(){var n={};if(0===t.length){n=0;for(var e=0;e<r.length;e++)n+=0===arguments.length?r[e]:r[e][arguments[0]];r=[n]}else r=y(arguments,function(e,r,t){var u=t;return g(n,u)||(n[u]=0),n[u]+=r});return this},A=function(){var n={};if(0===t.length){n=0;for(var e=0;e<r.length;e++)n+=0===arguments.length?r[e]:r[e][arguments[0]];r=[n/r.length]}else r=y(arguments,function(e,r,t){var u=JSON.stringify(t);return g(n,u)||(n[u]={count:0,sum:0}),n[u].count++,n[u].sum+=r,n[u].sum/n[u].count});return this},C=function(){var n={};return r=y(arguments,function(e,r,t){var u=JSON.stringify(t);return g(n,u)||(n[u]=0),++n[u]}),this},B=function(){var n={},e=0;if(0===t.length){n=-1;for(var u=0;u<r.length;u++)e=Number(0===arguments.length?r[u]:r[u][arguments[0]]),n=n>e||-1===n?e:n;r=[n]}else r=y(arguments,function(e,r,t){var u=JSON.stringify(t);return g(n,u)||(n[u]=0),(0===n[u]||r<n[u])&&(n[u]=r),n[u]});return this},M=function(){var n={},e=0;if(0===t.length){n=-1;for(var u=0;u<r.length;u++)e=Number(0===arguments.length?r[u]:r[u][arguments[0]]),n=e>n||-1===n?e:n;r=[n]}else r=y(arguments,function(e,r,t){var u=JSON.stringify(t);return g(n,u)||(n[u]=0),r>n[u]&&(n[u]=r),n[u]});return this},D=function(){var n=1,e=0===arguments.length?"ID":arguments[0],t=r.length>0&&!f(r[0]),u=[],a=null;l=!0;for(var s=0;s<r.length;s++)t?(a={},a[e]=n++,a.Value=r[s],u.push(a)):r[s][e]=n++;return t&&(r=u),this},H=function(){var n=arguments;return arguments.length>0&&i(arguments[0])?(q(arguments[0]),this):(r.sort(function(e,r){var t=JSON.stringify(p(e,n)),u=JSON.stringify(p(r,n));return u>t?-1:t>u?1:0}),this)},R=function(){if(0===arguments.length||!i(arguments[0])||0===arguments[0].length)return this;if(f(arguments[0][0])){var n=b(arguments);V(n),t=[];for(var e in arguments[0][0])t.push(e);C()}else{for(var r=0;r<arguments.length;r++)V(arguments[r]);G()}return this},X=function(){return 0!==arguments.length&&g(e,"func")?(J(e.func,arguments),e.func=null,this):this},z=function(){var n=[],e=null,t=null,l=!1,a=[],s=null;if(0===arguments.length)return this;if(s=arguments[0],0===s.length||0===r.length)return this;var o=!f(s[0]),g=!f(r[0]);if((!o||!g)&&arguments.length<2)throw"Invalid field or missing field!";if(arguments.length<2)a=[0];else if(i(arguments[1]))a=arguments[1];else for(var h=1;h<arguments.length;h++)a.push(arguments[h]);for(var c=0,m=0;m<r.length;m++){for(var v=0;v<s.length;v++){c=0;for(var d=0;d<a.length;d++)e=g?r[m]:r[m][a[d]],t=o?s[v]:s[v][a[d]],l=e===t,l&&c++;if(c===a.length)break}(v<s.length&&!u||v===s.length&&u)&&n.push(r[m])}return u=!1,r=n,this},K=function(){return O("inner",arguments),this},P=function(){return O("left",arguments),this},Q=function(){return O("full",arguments),this},U=function(){return u=!0,this},W=function(){var n=0;if(0===arguments.length||!c(arguments[0]))return this;var e=arguments[0];return n=e>-1&&arguments[0]<1?r.length*e:e,r=r.slice(n),this};return{from:j,select:w,top:F,bottom:S,where:x,distinct:G,groupBy:I,sum:L,count:C,min:B,max:M,avg:A,identity:D,orderBy:H,on:X,join:K,leftJoin:P,fullJoin:Q,concat:V,union:R,not:U,"in":z,skip:W}};