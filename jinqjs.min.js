var jinqJs=function(n){"use strict";var t=[],r=[],e=[],u=!1;jinqJs.settings="undefined"!=typeof n?n:{includeIdentity:!1};var i=function(n){return"undefined"==typeof n||0===n.length},s=function(n){return f(n,"length")&&!a(n)&&!o(n)},l=function(n){return null!==n&&n.constructor===Object},a=function(n){return null!==n&&n.constructor===String},f=function(n,t){return"undefined"!=typeof n[t]},o=function(n){return"function"==typeof n},c=function(n,t,r){for(var e=0;e<n.length;e++)if(n[e][t]==r)return!0;return!1},g=function(n,t){return h(n,t,!0)},h=function(n,t,r){var e=null,u=!1,i=[],s=!1;r=r||!1;for(var a=0;a<n.length;a++){u=!1;for(var f in t){if(e=n[a],s=l(e),!s&&e!=t[f]||s&&e[f]!=t[f]){u=!1;break}u=!0}if(u){if(r)return e;i.push(e)}}return 0===i.length?null:i},v=function(n,t){for(var r={},e=null,u=0;u<t.length;u++)e=t[u],r[e]=f(n,e)?n[e]:0;return r},m=function(n,t){for(var u=[],i=null,s=null,l=null,a=0;a<r.length;a++)if(i=v(r[a],e),s=v(r[a],n),l=g(u,i),null===l){l={};for(var f in i)l[f]=i[f];for(var o in s)l[o]=t(l[o],s[o],JSON.stringify(i)+o);u.push(l)}else for(var c in s)l[c]=t(l[c],r[a][c],JSON.stringify(i)+c);return u},d=function(n){for(var t=null,e=null,u=null,i=null,s=null,l=null,a=null,o=1,c=null,g=null,h=!1,v=0;v<n.length;v++)e=v>0?n[v-1]:null,t=n[v],u=f(t,"field")?t.field:null,o=f(t,"sort")&&"desc"===t.sort?-1:1,h=null===u||isNaN(u)?!1:!0,r.sort(function(n,t){return h?(i=Object.keys(n)[u],s=Object.keys(t)[u],null!==e&&(l=Object.keys(n)[e.field],a=Object.keys(t)[e.field])):(i=s=u,null!==e&&(l=a=e.field)),c=null===u?n:isNaN(n[i])?n[i]:Number(n[i]),g=null===u?t:isNaN(t[s])?t[s]:Number(t[s]),g>c&&(null===e||null===u||n[l]==t[a])?-1*o:c>g&&(null===e||null===u||n[l]==t[a])?1*o:0})},p=function(n){for(var t=[],r=0;r<n.length;r++)t=t.concat(n[r]);return t},y=function(n){for(var t={},r=0;r<n.length;r++)for(var e in n[r])t[e]=n[r][e];return t},b=function(n){var t={};for(var r in n)t[r]="";return t},N=function(n,e){var u=null,i=[],l=null,f=[],c=1;if(s(e)&&0!==e.length&&0!==t.length){switch(n){case"from":if(1===t.length)return void(r=t[0]);f=t[0];break;case"inner":case"left":f=r,c=0;break;default:return}for(var g=c;g<t.length;g++)i=[],f.forEach(function(r){o(e[0])?(l=[],t[g].forEach(function(n){e[0](r,n)&&l.push(n)}),0===l.length&&(l=null)):(u=v(r,e),l=h(t[g],u)),null!==l?a(l[0])?i.push(r):l.forEach(function(n){i.push(y([n,r]))}):"left"===n&&(t[g].length>0&&(u=b(t[g][0]),u=y([u,r])),i.push(y([r,u])))}),f=i;t=[],r=i}},O=function(n,r){if(0===r.length)return this;t=[],t.func=n;for(var e=0;e<r.length;e++)r[e].length>0&&t.push(r[e])},k=function(){var n=null,e=null;if(0===arguments.length)return this;for(var u=0;u<arguments.length;u++)if(null!==arguments[u]&&0!==arguments[u].length){if(2==arguments.length&&o(arguments[1]))n=arguments[0],e=arguments[1],u=arguments.length;else if(n=arguments[u],o(n))continue;if(a(n)){var i=new XMLHttpRequest;if(o(e)&&(i.self=this,i.onreadystatechange=function(){if(0!==i.response.length){var u=JSON.parse(i.response);n=s(u)?u:new Array(u),t.push(n),r=n,e(this.self)}}),i.open("GET",n,o(e)),i.send(),!o(e)){var l=JSON.parse(i.response);n=s(l)?l:new Array(l),t.push(n)}}else t.push(n)}return t.func="from",r=p(t),o(e)?e:this},J=function(){var n=null,t=!1,e=!1,l=[];if(i(r))return[];var a=null,c=null,g=null;if(jinqJs.settings.includeIdentity&&!u&&G(),i(arguments))return r;s(arguments[0])?(n=arguments[0],t=!0):o(arguments[0])?(n=arguments[0],e=!0):n=arguments;for(var h=0;h<r.length;h++){if(a={},e)a=n(r[h]);else for(var v=0;v<n.length;v++)t?(f(n[v],"field")&&(c=isNaN(n[v].field)?n[v].field:Object.keys(r[h])[n[v].field]),g=f(n[v],"text")?n[v].text:n[v].field):g=c=n[v],a[g]=f(n[v],"value")?o(n[v].value)?n[v].value(r[h]):n[v].value:f(r[h],c)?r[h][c]:r[h];l.push(a)}return l},S=function(){t.func=null;for(var n=0;n<arguments.length;n++)r=r.concat(arguments[n]);return this},j=function(n){var t=0;return t=Math.abs(n)>0&&Math.abs(n)<1?r.length*n:n,r=0>n?r.slice(t,r.length- -1*Math.abs(t)):r.slice(0,t),this},w=function(n){return j(-1*n),this},q=function(n){var t=[],e=!1,u=/([^\s]+)\s([<>=!*]{1,2})\s(.+)/,i=!1;if("undefined"==typeof n)return this;e=o(n);for(var s=0;s<r.length;s++){var l=r[s];if(e)n(l)&&t.push(l);else{for(var a=0;a<arguments.length;a++){var f=arguments[a].match(u);if(i=!1,null===f||4!==f.length)throw"Invalid predicate!";var c=f[2],g=f[1],h=f[3];switch(c){case"<":l[g]<h&&(i=!0);break;case">":l[g]>h&&(i=!0);break;case"!=":l[g]!=h&&(i=!0);break;case"=":case"==":l[g]==h&&(i=!0);break;case"<=":l[g]<=h&&(i=!0);break;case">=":l[g]>=h&&(i=!0);break;case"*":l[g].indexOf(h)>-1&&(i=!0)}if(!i)break}i&&t.push(l)}}return r=t,this},x=function(){if(i(arguments))return this;for(var n=[],t=null,e=null,u=0;u<r.length;u++){t=v(r[u],arguments);for(var s=0;s<arguments.length;s++)if(e=arguments[s],!c(n,e,t[e])){n.push(t);break}}return r=n,this},E=function(){return e=arguments,this},I=function(){var n={};return r=m(arguments,function(t,r,e){var u=e;return f(n,u)||(n[u]=0),n[u]+=r}),this},M=function(){var n={};return r=m(arguments,function(t,r,e){var u=JSON.stringify(e);return f(n,u)||(n[u]={count:0,sum:0}),n[u].count++,n[u].sum+=r,n[u].sum/n[u].count}),this},A=function(){var n={};return r=m(arguments,function(t,r,e){var u=JSON.stringify(e);return f(n,u)||(n[u]=0),++n[u]}),this},B=function(){var n={};return r=m(arguments,function(t,r,e){var u=JSON.stringify(e);return f(n,u)||(n[u]=0),(0===n[u]||r<n[u])&&(n[u]=r),n[u]}),this},D=function(){var n={};return r=m(arguments,function(t,r,e){var u=JSON.stringify(e);return f(n,u)||(n[u]=0),r>n[u]&&(n[u]=r),n[u]}),this},G=function(){var n=1,t=0===arguments.length?"ID":arguments[0];u=!0;for(var e=0;e<r.length;e++)r[e][t]=n++;return this},H=function(){var n=arguments;return arguments.length>0&&s(arguments[0])?(d(arguments[0]),this):(r.sort(function(t,r){var e=JSON.stringify(v(t,n)),u=JSON.stringify(v(r,n));return u>e?-1:e>u?1:0}),this)},L=function(){if(0===arguments.length||!s(arguments[0])||0===arguments[0].length)return this;var n=p(arguments);S(n),e=[];for(var t in arguments[0][0])e.push(t);return A(),this},R=function(){return 0!==arguments.length&&f(t,"func")?(N(t.func,arguments),t.func=null,this):this},T=function(){return O("inner",arguments),this},X=function(){return O("left",arguments),this};return{from:k,select:J,top:j,bottom:w,where:q,distinct:x,groupBy:E,sum:I,count:A,min:B,max:D,avg:M,identity:G,orderBy:H,on:R,join:T,leftJoin:X,concat:S,union:L}};